<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Voting Registration</title>
<link rel="icon" href="data:,">

<style>
body{
    margin:0;
    font-family: Arial, sans-serif;
    background:#f2f5f9;
    display:flex;
    justify-content:center;
    align-items:center;
    min-height:100vh;
}

.form-box{
    background:white;
    padding:25px;
    border-radius:10px;
    box-shadow:0 4px 10px rgba(0,0,0,0.1);
    width:100%;
    max-width:400px;
}

h2{
    text-align:center;
    margin-bottom:20px;
}

.input-group{
    margin-bottom:15px;
}

.input-group label{
    font-weight:bold;
    font-size:14px;
    display:block;
    margin-bottom:5px;
}

.input-group input{
    width:100%;
    padding:10px;
    border:1px solid #ccc;
    border-radius:5px;
    font-size:14px;
}

button{
    width:100%;
    padding:12px;
    background:#007bff;
    color:white;
    border:none;
    border-radius:5px;
    font-size:16px;
    cursor:pointer;
}

button:hover{
    background:#0056b3;
}

.message{
    text-align:center;
    margin-top:10px;
    font-weight:bold;
}
.success{
    color:green;
}
.error{
    color:red;
}
</style>

</head>

<body>

<div class="form-box">
    <h2>Voting Registration</h2>

    <div class="input-group">
        <label>Aadhar Number</label>
        <input id="aadhar" type="text" placeholder="Enter 12 digit Aadhar">
    </div>

    <div class="input-group">
        <label>Date of Birth</label>
        <input id="birth" type="date">
    </div>

    <div class="input-group">
        <label>Phone Number</label>
        <input id="phonenumber" type="text" placeholder="Enter 10 digit phone">
    </div>

    <div class="input-group">
        <label>Vote ID</label>
        <input id="voteid" type="text" placeholder="Enter Vote ID">
    </div>

    <button type="button" id="submitBtn">Submit</button>

    <div id="message" class="message"></div>
</div>

<script type="module">

import { initializeApp } from "https://www.gstatic.com/firebasejs/12.9.0/firebase-app.js";
import { 
    getFirestore, 
    doc,
    setDoc,
    getDoc,
    Timestamp 
} from "https://www.gstatic.com/firebasejs/12.9.0/firebase-firestore.js";

// ðŸ”¹ Your Firebase Config
const firebaseConfig = {
                apiKey: "AIzaSyBjm6WKCRmUNILEub4lKecRx11Lwvf-koM",
    authDomain: "tn-voting-d09c5.firebaseapp.com",
    projectId: "tn-voting-d09c5",
    storageBucket: "tn-voting-d09c5.appspot.com",
    messagingSenderId: "739902489472",
    appId: "1:739902489472:web:362809592ddf36884c3765"
};

const app = initializeApp(firebaseConfig);
const db = getFirestore(app);

async function insertdata() {

    const aadhar = document.getElementById("aadhar").value.trim();
    const birth = document.getElementById("birth").value;
    const ph_no = document.getElementById("phonenumber").value.trim();
    const vote_id = document.getElementById("voteid").value.trim();
    const message = document.getElementById("message");

    message.innerHTML = "";

    if (!aadhar || !birth || !ph_no || !vote_id) {
        message.innerHTML = "<span class='error'>All fields are required!</span>";
        return;
    }

    try {

        const docRef = doc(db, "voting", vote_id);
        const docSnap = await getDoc(docRef);

        if (docSnap.exists()) {
            message.innerHTML = "<span class='error'>Vote ID already registered!</span>";
            return;
        }

        await setDoc(docRef, {
            aadhar: aadhar,
            birth: Timestamp.fromDate(new Date(birth)),
            isvoted: false,
            ph_no: ph_no,
            vote_id: vote_id,
            createdAt: Timestamp.now()
        });

        message.innerHTML = "<span class='success'>Registration Successful!</span>";

        // Clear inputs
        document.getElementById("aadhar").value = "";
        document.getElementById("birth").value = "";
        document.getElementById("phonenumber").value = "";
        document.getElementById("voteid").value = "";

    } catch (error) {
        message.innerHTML = "<span class='error'>" + error.message + "</span>";
    }
}

// Safe button event
document.getElementById("submitBtn").addEventListener("click", insertdata);

</script>

</body>
</html>